<?php $pageTitle = isset($pageTitle) ? $pageTitle : 'Events - Admin'; $activeNav = $activeNav ?? 'admin'; ?>
<?php include __DIR__ . '/../components/header.html'; ?>

<section class="admin-page">
    <div class="section">
        <div class="text-title-large">Event Management</div>
        <p class="text-desc">View and manage all events on the platform.</p>
    </div>

    <div class="section panel">
        <div class="events-grid">
            <div class="text-subtitle">Match Details</div>
            <?php if (!empty($events)): ?>
            <div class="cards two-col">
                <?php foreach($events as $event): ?>
                <article class="card">
                    <div class="card-media"
                        style="background-image:url('<?= htmlspecialchars($event['imageUrl'] ?? 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNFMEUwRTAiLz48L3N2Zz4=') ?>')">
                    </div>
                    <div class="card-body">
                        <h3 class="text-title-smaller">
                            <?= htmlspecialchars($event['title'] ?? $event['name'] ?? '') ?>
                        </h3>
                        <p class="meta text-small">
                            <span class="material">event</span>
                            <?= htmlspecialchars($event['dateTime'] ?? $event['date'] ?? '') ?>
                        </p>
                        <p class="meta text-small">
                            <span class="material">location_on</span>
                            <?= htmlspecialchars($event['location'] ?? $event['coords'] ?? 'No location') ?>
                        </p>
                        <p class="meta text-small">
                            <span class="material">people</span>
                            <?= (int)($event['current_participants'] ?? 0) . ' / ' . (int)($event['max_participants'] ?? $event['participants'] ?? 0) ?>
                        </p>
                        <p class="meta text-small">
                            <span class="material">contact_mail</span>
                            <?= htmlspecialchars($event['organizer_email'] ?? $event['email'] ?? 'No contact') ?>
                        </p>
                        <p class="meta text-small">
                            <span class="material">pin_drop</span>
                            <?= htmlspecialchars($event['coords'] ?? $event['location'] ?? 'No coordinates') ?>
                        </p>
                        <div class="card-actions">
                            <a href="/event/<?= (int)($event['id'] ?? 0) ?>" class="btn-link">View</a>
                            <button class="btn-link btn-delete"
                                data-event-id="<?= (int)($event['id'] ?? 0) ?>">Delete</button>
                        </div>
                    </div>
                </article>
                <?php endforeach; ?>
            </div>
            <?php else: ?>
            <div class="empty-panel empty-dashed">
                <span class="material">event_note</span>
                <div class="text-title-smaller">No events found</div>
                <p class="text-body">There are no events to manage at the moment.</p>
            </div>
            <?php endif; ?>
        </div>
    </div>
</section>

<script>
    document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', function () {
            const eventId = this.dataset.eventId;
            if (!confirm('Are you sure you want to delete this event?')) return;

            fetch('/event/' + eventId + '/cancel', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({})
            })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        location.reload();
                    } else {
                        alert('Error: ' + (data.message || 'Unknown error'));
                    }
                })
                .catch(err => alert('Error: ' + err));
        });
    });
</script>

<?php include __DIR__ . '/../components/footer.html'; ?>