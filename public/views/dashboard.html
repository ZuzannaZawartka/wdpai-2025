<?php $pageTitle = 'FindRival Dashboard'; $activeNav = $activeNav ?? 'dashboard'; ?>
<?php include __DIR__ . '/components/header.html'; ?>

<section class="hero">
    <div class="hero-grid">
        <div class="hero-copy">
            <h1 class="text-title-large">Unleash Your Inner Athlete</h1>
            <p class="text-desc">Discover local sports events and connect with fellow enthusiasts. Your next game is
                just a click away.
            </p>
            <div class="actions">
                <a href="/sports" class="button primary text-size-small">Find Your Next Game</a>
                <?php if(($_SESSION['user_role'] ?? 'user') !== 'admin'): ?>
                <a href="/create" class="button accent with-icon text-size-small"><span class="icon">＋</span> Create
                    Event</a>
                <?php endif; ?>
            </div>
        </div>
        <?php include __DIR__ . '/components/dashboard-animation.html'; ?>
    </div>
    <div class="backdrop"></div>
    <div class="container pad">
        <div class="panel">
            <section class="section compact">
                <?php
                $sectionTitle = 'Your Upcoming Events';
                $sectionLink = '/sports';
                $sectionLinkText = 'View All';
                include __DIR__ . '/components/section-header.html';
            ?>
                <?php $upcoming = $upcomingEvents ?? []; ?>
                <?php if (!empty($upcoming)): ?>
                <div class="cards two-col">
                    <?php foreach ($upcoming as $ev): ?>
                    <article class="card">
                        <div class="card-media"
                            style="background-image:url('<?= htmlspecialchars($ev['imageUrl']) ?>')">
                        </div>
                        <div class="card-body">
                            <h3 class="text-title-smaller">
                                <?= htmlspecialchars($ev['title']) ?>
                            </h3>
                            <p class="meta text-small">
                                <?= htmlspecialchars($ev['dateText']) ?>
                            </p>
                            <p class="meta text-small">
                                <?= htmlspecialchars($ev['location']) ?>
                            </p>
                            <a href="/event/<?= (int)($ev['id'] ?? 0) ?>" class="button primary small block">View
                                Details</a>
                        </div>
                    </article>
                    <?php endforeach; ?>
                </div>
                <?php else: ?>
                <?php
                $emptyIcon = 'event_note';
                $emptyTitle = 'No upcoming events yet.';
                $emptyText = 'Join an event to get started!';
                $emptyLink = '/sports';
                $emptyLinkText = 'Browse Events';
                include __DIR__ . '/components/empty-state.html';
            ?>
                <?php endif; ?>
            </section>

            <section class="section">
                <?php
                $sectionTitle = 'Your favourite sports';
                include __DIR__ . '/components/section-header.html';
            ?>
                <div class="grid-quick">
                    <?php $fav = $favouriteSports ?? []; foreach ($fav as $s): ?>
                    <a href="/sports?sport=<?= urlencode($s['name']) ?>" class="tile">
                        <div class="tile-icon material">
                            <?= htmlspecialchars($s['icon']) ?>
                        </div>
                        <div>
                            <h3 class="text-title-smaller">
                                <?= htmlspecialchars($s['name']) ?>
                            </h3>
                            <p class="text-small">
                                <?= htmlspecialchars($s['name']) ?> Enthusiast
                            </p>
                        </div>
                    </a>
                    <?php endforeach; ?>
                    <a href="/profile" class="tile add">
                        <div class="tile-add text-size-small">＋</div>
                        <p class="text-small">Add Sport</p>
                    </a>
                </div>
            </section>

            <section class="section">
                <?php
                $sectionTitle = 'Personalized Suggestions';
                $sectionLink = '/sports';
                $sectionLinkText = 'See More';
                include __DIR__ . '/components/section-header.html';
            ?>
                <?php $recs = $suggestions ?? []; ?>
                <?php if (!empty($recs)): ?>
                <div class="cards three-col">
                    <?php foreach ($recs as $rec): ?>
                    <article class="card">
                        <div class="card-media"
                            style="background-image:url('<?= htmlspecialchars($rec['imageUrl']) ?>')">
                        </div>
                        <div class="card-body">
                            <h3 class="text-title-smaller">
                                <?= htmlspecialchars($rec['title']) ?>
                            </h3>
                            <p class="meta text-small">
                                <?= htmlspecialchars($rec['start_time']) ?>
                            </p>
                            <div class="meta-row text-small">
                                <span><span class="material">groups</span>
                                    <?= htmlspecialchars($rec['current_players']) ?> /
                                    <?= htmlspecialchars($rec['max_players']) ?>
                                </span>
                                <span class="level"
                                    style="--level-color: <?= htmlspecialchars($rec['level_color']) ?>;">
                                    <i class="color-indicator"></i>
                                    <?= htmlspecialchars($rec['level_name'] ?? 'Intermediate') ?>
                                </span>
                            </div>
                            <a href="/event/<?= (int)($rec['id'] ?? 0) ?>" class="button primary small block">
                                View Details
                            </a>
                        </div>
                    </article>
                    <?php endforeach; ?>
                </div>
                <?php else: ?>
                <?php
                $emptyIcon = 'explore';
                $emptyTitle = 'No personalized suggestions yet.';
                $emptyText = 'Join events or add favourite sports to get tailored picks.';
                $emptyLink = '/sports';
                $emptyLinkText = 'Browse Events';
                include __DIR__ . '/components/empty-state.html';
            ?>
                <?php endif; ?>
            </section>
        </div>
    </div>
</section>

<?php include __DIR__ . '/components/footer.html'; ?>