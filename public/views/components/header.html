<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
        <?= isset($pageTitle) ? htmlspecialchars($pageTitle) : 'Dashboard' ?>
    </title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/public/styles/main.css" />
    <link rel="stylesheet" href="/public/styles/components/header.css" />
    <?php $active = $activeNav ?? 'dashboard'; ?>
    <?php if (
        $active === 'admin' ||
        (isset($activeNav) && ($activeNav === 'admin' || $activeNav === 'accounts' || $activeNav === 'edit-user'))
    ): ?>
    <link rel="stylesheet" href="/public/styles/accounts.css" />
    <?php endif; ?>
    <?php if ($active === 'dashboard'): ?>
    <link rel="stylesheet" href="/public/styles/dashboard.css" />
    <?php endif; ?>
    <?php if (isset($activeNav) && ($activeNav === 'sports' || $activeNav === 'joined' || $activeNav === 'my' || $activeNav === 'profile')): ?>
    <link rel="stylesheet" href="/public/styles/sports.css" />
    <?php endif; ?>
    <?php if (isset($activeNav) && $activeNav === 'joined'): ?>
    <link rel="stylesheet" href="/public/styles/joined.css" />
    <?php endif; ?>
    <?php if (isset($activeNav) && $activeNav === 'my'): ?>
    <link rel="stylesheet" href="/public/styles/my.css" />
    <?php endif; ?>
    <?php if (isset($activeNav) && ($activeNav === 'create' || $activeNav === 'event-edit')): ?>
    <link rel="stylesheet" href="/public/styles/create.css" />
    <?php endif; ?>

    <link rel="stylesheet" href="/public/styles/components/sports-tiles.css" />

    <?php if (isset($activeNav) && $activeNav === 'profile'): ?>
    <link rel="stylesheet" href="/public/styles/profile.css" />
    <?php endif; ?>

    <link rel="stylesheet" href="/public/styles/components/modal.css" />
</head>

<body class="app">
    <div class="layout">
        <header class="site-header">
            <div class="header-inner">
                <button class="mobile-hamburger" aria-label="Menu" aria-expanded="false" type="button">
                    <span class="material-symbols-outlined">menu</span>
                </button>
                <div class="brand">
                    <?php include __DIR__ . '/../components/logo.html'; ?>
                </div>
                <nav class="site-nav">
                    <?php $active = $activeNav ?? 'dashboard'; ?>
                    <?php $isAdmin = ($_SESSION['user_role'] ?? 'user') === 'admin'; ?>

                    <?php if ($isAdmin): ?>
                    <a class="nav-link <?= $active==='sports' ? 'active' : '' ?>" href="/sports">Sports</a>
                    <a class="nav-link <?= $active==='accounts' ? 'active' : '' ?>" href="/accounts">Accounts</a>
                    <?php else: ?>
                    <a class="nav-link <?= $active==='dashboard' ? 'active' : '' ?>" href="/dashboard">Dashboard</a>
                    <a class="nav-link <?= $active==='sports' ? 'active' : '' ?>" href="/sports">Sports</a>
                    <a class="nav-link search-tile with-icon text-compact-strong button accent <?= $active==='create' ? 'active' : '' ?>"
                        href="/create">Create
                        Event</a>
                    <a class="nav-link <?= $active==='my' ? 'active' : '' ?>" href="/my">My Events</a>
                    <a class="nav-link <?= $active==='joined' ? 'active' : '' ?>" href="/joined">Joined Events</a>
                    <?php endif; ?>
                </nav>
                <div class="user-area">
                    <a class="logout" href="/logout">Logout</a>
                    <div class="avatar-wrap">
                        <?php
                            $avatarSrc = $currentAvatar ?? (isset($user['avatar']) ? $user['avatar'] : (($_SESSION['user_avatar'] ?? null) ?: DEFAULT_AVATAR));
                        ?>
                        <a href="/profile" class="avatar" role="img" aria-label="User profile picture"
                            style="background-image: url('<?= htmlspecialchars($avatarSrc) ?>')"></a>
                    </div>
                </div>
            </div>
        </header>
        <main class="site-main">
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    const hamburger = document.querySelector('.mobile-hamburger');
                    const nav = document.querySelector('.site-nav');
                    if (!hamburger || !nav) return;
                    hamburger.addEventListener('click', function () {
                        const expanded = hamburger.getAttribute('aria-expanded') === 'true';
                        hamburger.setAttribute('aria-expanded', !expanded);
                        nav.classList.toggle('mobile-open', !expanded);
                    });
                });
            </script>